# Ejemplo de data integration empleando conectores jdbc

## Setup de la base de datos de ORIGEN

1.- Con [dbvision](../../../../dbvision) accedemos con el usuario `system` a Oracle y creamos los siguientes elementos

```sql
CREATE USER MISTESTS IDENTIFIED BY mipassword;
GRANT ALL PRIVILEGES TO MISTESTS;
```

2.- Ahora abrimos una nueva sesión pero esta vez con el usuario 
`MISTESTS` y el password `mipassword`

creamos la siguiente tabla:

```sql
DROP TABLE  MISTESTS.MISUSUARIOS;
CREATE TABLE MISTESTS.MISUSUARIOS (
    id NUMBER(2,0) GENERATED BY DEFAULT AS IDENTITY,
    nombre VARCHAR2(100),
    fecha TIMESTAMP DEFAULT SYSTIMESTAMP,
    apellido VARCHAR2(100),
    telefono VARCHAR2(20),
    edad NUMBER(3,0),
    altura DECIMAL(18,5)
);
```

3.- Creamos una vista 

```sql
CREATE OR REPLACE VIEW VW_MISUSUARIOS AS SELECT * FROM MISTESTS.MISUSUARIOS;
```

4.- Insertamos [algunos usuarios](usuarios.sql)

```sql
INSERT INTO MISTESTS.MISUSUARIOS (nombre, apellido, telefono, edad, altura) VALUES ('Juan', 'Pérez', '555-1234', 25, 1.80);
...
```

5.- Validamos que se ha cargado

```sql
select * FROM MISTESTS.VW_MISUSUARIOS ORDER BY FECHA DESC;
``` 

## Setup de un conector source

Ejecutamos el script [createSrcConnect.sh](createSrcConnect.sh) y este nos generará un conector de tipo `source`. Validamos que se inserta en un topic de Kafka.

```bash
./createSrcConnect.sh
```

## Setup de la base de datos de DESTINO

Creamos una base de datos de destino donde insertará el conector sink. Será la misma que la de origen pero con otro nombre:

```sql
DROP TABLE  MISTESTS.MISUSUARIOS_DESTINO;
CREATE TABLE MISTESTS.MISUSUARIOS_DESTINO (
    id NUMBER(2,0) GENERATED BY DEFAULT AS IDENTITY,
    nombre VARCHAR2(100),
    fecha TIMESTAMP DEFAULT SYSTIMESTAMP,
    apellido VARCHAR2(100),
    telefono VARCHAR2(20),
    edad NUMBER(3,0),
    altura DECIMAL(18,5)
);
```

## Set up de un conector sink

Ejecutamos el script [createSnkConnect.sh](createSnkConnect.sh) y este nos generará un conector de tipo `sink`. Validamos que se inserta en un topic de Kafka.

```bash
./createSnkConnect.sh
```

Validamos que se insertan registros en la tabla destino:

```sql
select * from MISTESTS.MISUSUARIOS_DESTINO;
```